print("02. Doublet-Finder.qmd")
#| message: false
libs <- c("Seurat", "tidyverse", "gplots", "ComplexHeatmap","circlize","readxl", "fgsea","ggpubr")
suppressMessages(
suppressWarnings(sapply(libs, require, character.only =TRUE))
)
#| echo: false
#| message: false
#| warning: false
# upload the geneset file
genesets <- read_excel("~/d/Ricardo/HuMicA/Integration/without_RM102/Humica/res0.2/Genesets_literature.xlsx")
#| message: false
#| warning: false
#| results: hide
Humica@active.ident <- factor(x = Humica@active.ident, levels = c("0","1","2","3","4","5","6","7","8"))
#| echo: false
#| message: false
#| warning: false
#| results: hide
# upload the HuMicA
Humica <- readRDS("~/d/Ricardo/HuMicA/Integration/without_RM102/Humica/Humica.rds")
DefaultAssay(Humica)<- "integrated"
Humica <- RunPCA(Humica, verbose = FALSE)
Humica <- RunUMAP(Humica, reduction = "pca", dims = 1:50)
Humica <- FindNeighbors(Humica,  reduction = "pca",dims = 1:50)
Humica <- FindClusters(Humica,resolution =0.2)
#| fig-width: 6
#| fig-height: 6
color_clusters <-c("#fdc835ff", "#FC8D62", "#7570B3" ,"#679436", "#D43921" ,"#344D67", "#874C62" ,"#937666", "#5B7B7A" )
DefaultAssay(Humica)<-"integrated"
DimPlot(Humica, reduction = "umap", order = rev(levels(Idents(Humica))),
cols = color_clusters,
group.by = "integrated_snn_res.0.2", raster = FALSE,pt.size =0.001)
DefaultAssay(Humica)<-"RNA"
Humica <- NormalizeData(Humica) #gene expression is evaluated using the normalized "RNA" assay
# Dotplot
DotPlot(Humica, features = c("P2RY12","CX3CR1", "MRC1","CD163"), dot.scale = 10, group.by ="integrated_snn_res.0.2") +
scale_colour_gradient2(low = "darkblue", mid = "white", high = "darkred")+
#scale_color_viridis_c() +
theme(axis.text.x = element_text(angle=90, hjust = 0))+coord_flip()
# Feature plot of the Module Score of macrophage markers
Mac_genes <- c("MRC1","CD163")
Humica <- AddModuleScore(Humica,
features =list(Mac_genes),
name='Mac_genes')
FeaturePlot(Humica, features = 'Mac_genes1', label = F, repel = TRUE,pt.size = 0.5) & scale_colour_gradientn(colours = c("#FCFCFF","#FCFCFF","#DCF2CE","#FFCB77","#BD6B73","#A30B37"))
#| message: false
#| warning: false
Humica.markers <- FindAllMarkers(Humica,assay = "RNA", only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25, test.use = "MAST")
library(MAST)
BiocManager::install("MAST")
#| message: false
#| warning: false
Humica.markers <- FindAllMarkers(Humica,assay = "RNA", only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25, test.use = "MAST")
